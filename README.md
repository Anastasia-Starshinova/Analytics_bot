# Telegram Bot –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∏–¥–µ–æ-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

# –ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π Telegram-–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∏–¥–µ–æ –∏–∑ –¥–≤—É—Ö —Ç–∞–±–ª–∏—Ü PostgreSQL: videos –∏ video_snapshots. –ó–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ LLM (GPT), –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è (action) –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (params), –ø–æ—Å–ª–µ —á–µ–≥–æ –±–æ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## ‚ö° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–∞ Telegram-–±–æ—Ç–∞
1. –°–æ–∑–¥–∞–π –±–æ—Ç–∞ —á–µ—Ä–µ–∑ BotFather
2. –ü–æ–ª—É—á–∏ —Ç–æ–∫–µ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ: 123456789:ABC-DEF1234ghIkl-zyx57W2v1u123ew11.
3. –ü–æ–º–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω –≤ Variables –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Railway (–µ—Å–ª–∏ –≤—ã–∫–ª–∞–¥—ã–≤–∞–µ—à—å –Ω–∞ Railway):


## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
bot.py
```
–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–æ–º–∞–Ω–¥

```
app.py
```
FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è webhook

```
config.py
```
—Ñ–∞–π–ª —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

```
db.py
```
—Ä–∞–±–æ—Ç–∞ —Å PostgreSQL —á–µ—Ä–µ–∑ asyncpg

```
openai_client.py
```
–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å openai

```
requirements.txt
```
Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```
Procfile
```
–∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

```
.env
```
–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è


## ‚úÖ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.
–§—É–Ω–∫—Ü–∏—è detect_intent_sync –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ LLM (GPT-3.5 / GPT-4), —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å:
1. action ‚Äî —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, total_videos, creator_videos_views_final, negative_view_snapshots –∏ —Ç.–¥.)
2. params ‚Äî —Å–ª–æ–≤–∞—Ä—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–¥–∞—Ç–∞, –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—Ä–µ–º–µ–Ω–∏, ID –∫—Ä–µ–∞—Ç–æ—Ä–∞, –≤–∏–¥–µ–æ –∏ –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è).
–ü–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è intent –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è query_database, –∫–æ—Ç–æ—Ä—ã–π —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ Telegram.

## üß† –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LLM –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
## –ú–æ–¥–µ–ª—å: GPT-3.5-turbo (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ GPT-4 –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü–µ—Ä–µ–¥–∞–µ–º GPT –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö:
   - –¢–∞–±–ª–∏—Ü—ã: videos –∏ video_snapshots
   - –ü–æ–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å —Ç–∏–ø–∞–º–∏
   - –û–±—ä—è—Å–Ω—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (action) –∏ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (params)

2. –§–æ—Ä–º–∏—Ä—É–µ–º prompt ‚Äî –≤ –Ω–µ–≥–æ –≤–∫–ª—é—á–∞–µ—Ç—Å—è:
   - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –ø–æ–ª–µ–π
   - –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –∫–∞–∫ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å JSON —Å –ø–æ–ª—è–º–∏ action –∏ params
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å
```
–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞:
–¢—ã - –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –±–æ—Ç–∞ Telegram, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ videos –∏ video_snapshots.
–û–ø—Ä–µ–¥–µ–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ (action) –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (params) –¥–ª—è SQL-–∑–∞–ø—Ä–æ—Å–∞.
–í–µ—Ä–Ω–∏ JSON:
{
    "action": "<—Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è>",
    "params": {
        "date": "YYYY-MM-DD",
        "start_time": "HH:MM",
        "end_time": "HH:MM",
        "creator_id": "<id>",
        "video_id": "<id>",
        "threshold": <—á–∏—Å–ª–æ>
    }
}
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å: "{text}"

LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON, –Ω–∞–ø—Ä–∏–º–µ—Ä:
{
    "action": "creator_videos_views_final",
    "params": {
        "creator_id": "aca1061a9d324ecf8c3fa2bb32d7be63",
        "threshold": 10000
    }
}
```

3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞:
   - –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª—è action –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –≤–µ—Ç–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ query_database.
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ JSON (params) –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π SQL-–∑–∞–ø—Ä–æ—Å.
   - –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

## üî• –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞:
1. –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø–∏—Å–∞—Ç—å SQL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞.
2. LLM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ, —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–µ, –≤—Ä–µ–º–µ–Ω–∏ –∏ threshold.
3. –°—Ç—Ä–æ–≥–∏–π JSON –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ SQL.
